@inherits LayoutComponentBase
@using Thryft.Services
@inject CartService cartService
@inject NavigationManager Navigation
@inject AuthService AuthService
@inject UserService userService

<MudThemeProvider Theme="ThryftTheme" />
<MudDialogProvider />
<MudSnackbarProvider />

<style>
    .content {
        padding-top: 1.1rem;
        height: fit-content;
    }

    .page-with-bg {
        position: relative;
        min-height: 100vh;
    }

    .background-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #ffece8;
        /* background-image: url('/images/thryft-background.jpg');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat; */
        opacity: 1; /* Adjust opacity here */
        z-index: -1;
    }

    .content-wrapper {
        position: relative;
        z-index: 1;
    }

    .website-footer {
        position: absolute;
        width: 100vw;
        background: #ed9191;
        color: white;
        padding: 3rem 0 2rem;
        margin-top: 4rem;
    }

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
    }

</style>

<div class="page-with-bg">
    <!-- Background -->
    <div class="background-overlay"></div>

    @* @if (isInitializing)
    {
        <MudContainer Class="d-flex justify-center align-center" Style="height: 100vh;">
            <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
        </MudContainer>
    }
    else
    { *@

        <!-- Content -->
        <div class="content-wrapper">
            <main>
                <NavMenu />
                <div class="top-row px-4"></div>
                <article class="content px-4 mt-4">
                    @Body
                </article>
                <!-- Website Footer -->
                <div class="website-footer">
                    <div class="footer-content">
                        <MudGrid Spacing="4">
                            <MudItem xs="12" md="4">
                                <MudText Typo="Typo.h6" Class="mb-3" Style="font-weight: 600;">Thryft</MudText>
                                <MudText Typo="Typo.body2" Class="mb-2">Premium online shopping experience</MudText>
                                <MudText Typo="Typo.body2">Your trusted partner for quality products</MudText>
                            </MudItem>
                            <MudItem xs="12" md="4">
                                @* <MudText Typo="Typo.h6" Class="mb-3" Style="font-weight: 600;">Quick Links</MudText>
                                <MudLink Color="Color.Tertiary" Typo="Typo.body2" OnClick="GoToHome" Class="mb-1">Products</MudLink>
                                <br />
                                <MudLink Color="Color.Tertiary" Typo="Typo.body2" OnClick="GoToCart" Class="mb-1">Cart</MudLink>
                                <br />
                                <MudLink Color="Color.Tertiary" Typo="Typo.body2" OnClick="GoToOrders" Class="mb-1">Orders</MudLink> *@
                            </MudItem>
                            <MudItem xs="12" md="4">
                                <MudText Typo="Typo.h6" Class="mb-3" Style="font-weight: 600;">Contact</MudText>
                                <MudText Typo="Typo.body2" Class="mb-1">support@thryft.com</MudText>
                                <MudText Typo="Typo.body2" Class="mb-1">012 345 6789</MudText>
                            </MudItem>
                        </MudGrid>
                        <MudDivider Class="my-4" Color="Color.Dark" />
                        <MudText Typo="Typo.caption" Class="text-center">
                            © 2025 Thryft. All rights reserved.
                        </MudText>
                    </div>
                </div>
            </main>
        </div>
        @* } *@
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@code {

    private bool isInitializing = true;

    MudTheme ThryftTheme = new MudTheme()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#efa3a0",
            Secondary = "#ffdec7",
            Tertiary = "#ffeedd",
            Info = "#eb8691",
            AppbarBackground = "#ed9191",
            TextPrimary = "#493129"
        }
    };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await userService.InitializeAsync();
            isInitializing = false;
            StateHasChanged();
        }
    }

    private void GoToHome()
    {
        Navigation.NavigateTo("/home");
    }

    private void GoToCart()
    {
        Navigation.NavigateTo("/cart");
    }

    private void GoToOrders()
    {
        Navigation.NavigateTo("/orders");
    }

    private async Task Logout()
    {
        await AuthService.LogoutAsync();
    }
}